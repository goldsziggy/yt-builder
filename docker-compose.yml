version: '3.8'

services:
  yt-builder:
    build:
      context: .
      dockerfile: Dockerfile
    image: yt-builder:latest
    container_name: yt-builder

    # Mount local directories to container
    volumes:
      # Mount media directories
      - ./videos:/app/videos:ro        # Read-only access to input videos
      - ./music:/app/music:ro          # Read-only access to music files
      - ./quotes:/app/quotes:ro        # Read-only access to quotes
      - ./sounds:/app/sounds:ro        # Read-only access to sound effects

      # Mount output directory (read-write)
      - ./output:/app/output

      # Mount temp directory for intermediate files
      - ./.tmp:/app/.tmp

    # Set working directory
    working_dir: /app

    # Environment variables for configuration
    # All settings can be configured via environment variables prefixed with YT_BUILDER_
    environment:
      # Required: Duration of the output video in seconds
      YT_BUILDER_DURATION: "600"

      # Quote timing settings
      YT_BUILDER_QUOTES_DURATION: "5.0"
      YT_BUILDER_QUOTES_MIN_BETWEEN: "10.0"
      YT_BUILDER_QUOTES_MAX_BETWEEN: "30.0"

      # Shuffle options (true/false, 1/0, yes/no, on/off)
      YT_BUILDER_MUSIC_SHUFFLE: "true"
      YT_BUILDER_QUOTES_SHUFFLE: "true"

      # Output configuration
      YT_BUILDER_OUTPUT: "/app/output/video.mp4"
      YT_BUILDER_FPS: "30"
      YT_BUILDER_RESOLUTION: "1920x1080"
      YT_BUILDER_TRANSITION: "crossfade"

      # Audio levels (0.0 to 1.0)
      YT_BUILDER_MUSIC_VOLUME: "0.7"
      YT_BUILDER_SOUNDS_VOLUME: "0.5"

      # Quote styling (minimal, centered, bottom, top)
      YT_BUILDER_QUOTE_STYLE: "centered"

      # Utility options
      YT_BUILDER_VERBOSE: "true"
      # YT_BUILDER_DRY_RUN: "false"

    # Resource limits (optional, adjust as needed)
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '4'
    #       memory: 4G
    #     reservations:
    #       cpus: '2'
    #       memory: 2G

# Example usage with environment variables:
# docker-compose up
#
# Example usage with command-line arguments (overrides env vars):
# docker-compose run --rm yt-builder --duration 60 --quotes-duration 5 -o /app/output/test.mp4
#
# Example usage with .env file:
# 1. Copy .env.example to .env
# 2. Edit .env with your settings
# 3. Run: docker-compose --env-file .env up
